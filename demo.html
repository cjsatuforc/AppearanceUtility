<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Demo Palette</title>
</head>
<body>
<p id='p1'>Click the button below or use the "Send info to HTML" command in the ADD-INS panel.</p>
<button onclick='sendInfoToFusion()' type='button'>Click to send info to Fusion</button>
<br/><br/>
<p id='message'>Send a Message from Fusion 360 here by clicking Fusion Palette Send Command</p>
<br/><br/>
<div id="jstree_demo_div"></div>
</body>
<link href="static/themes/default/style.min.css" rel="stylesheet"/>
<script src="static/jquery-1.11.0.min.js"></script>
<script src="static/jstree.js"></script>

<script>
    function sendInfoToFusion() {
        var args = {
            arg1: "Sample argument 1",
            arg2: "Sample argument 2"
        };
        adsk.fusionSendData('send', JSON.stringify(args));
    }

    window.fusionJavaScriptHandler = {
        handle: function (action, data) {
            try {
                if (action === 'send') {
                    // Update a paragraph with the data passed in.
                    document.getElementById('message').innerHTML = data;
                } else if (action === 'debugger') {
                    debugger;
                } else if (action === 'tree_update') {

                    if (!data || data.length === 0) return;
                    document.getElementById('message').innerHTML = "something happening";
                    $('#jstree_demo_div').jstree(true).settings.core.data = JSON.parse(data).core;
                    $('#jstree_demo_div').jstree(true).refresh();
                } else {
                    return 'Unexpected command type: ' + action;
                }
            } catch (e) {
                console.log(e);
                console.log('exception caught with command: ' + action + ', data: ' + data);
            }
            return 'OK';
        }
    };

    $('#jstree_demo_div').jstree({
        "core": {
            "check_callback": true
        },
        "plugins": ["wholerow", "sort", "checkbox", "unique", "dnd"]
    })
        .on("select_node.jstree", function (e, data) {
            navigate(data.node.id, null);
        });


</script>
</html>